{% extends "layout.html" %}

{% block title %}Edit Server {{ server.name }} - {{ panel_name }}{% endblock %}

{% block header %}
<div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
    <div style="display: flex; align-items: center; gap: 1rem;">
        <a href="/servers/{{ server.id }}/manage" style="color: #6c757d; text-decoration: none; display: flex; align-items: center; font-size: 0.9em;">
            <span style="font-size: 1.2em; margin-right: 0.3rem;">‚Üê</span> Back
        </a>
        <span>Edit {{ server.name }}</span>
    </div>
</div>
{% endblock %}

{% block content %}
<form action="/servers/{{ server.id }}/update" method="POST" style="max-width: 1200px;">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">

        <!-- Left Column -->
        <div>
            <!-- Core Details -->
            <div class="section-card"
                style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                <h3 style="margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">
                    Core Details</h3>

                <div class="form-group">
                    <label for="name">Server Name</label>
                    <input type="text" id="name" name="name" value="{{ server.name }}" required>
                </div>

                <div class="form-group">
                    <label for="description">Server Description</label>
                    <input type="text" id="description" name="description" value="{{ server.description.as_deref().unwrap_or_default() }}">
                </div>

                <div class="form-group">
                    <label for="owner_id">Server Owner</label>
                    <select id="owner_id" name="owner_id">
                        <option value="1">Administrator (admin@yunexal.com)</option>
                    </select>
                </div>
            </div>

            <!-- Application Feature Limits -->
            <div class="section-card"
                style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                <h3 style="margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">
                    Application Feature Limits</h3>

                <div class="form-group">
                    <label for="backup_limit">Backup Limit</label>
                    <input type="number" id="backup_limit" name="backup_limit" value="{{ server.backup_limit }}" min="0">
                </div>
            </div>

             <!-- Danger Zone -->
             <div class="section-card"
             style="background: #fff5f5; border: 1px solid #fed7d7; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem;">
             <h3 style="margin-top: 0; border-bottom: 1px solid #feb2b2; padding-bottom: 10px; margin-bottom: 15px; color: #c53030;">
                 Danger Zone</h3>
            <p style="color: #742a2a; margin-bottom: 1rem;">Deleting a server is irreversible.</p>
             <button type="button" class="btn btn-danger" onclick="document.getElementById('delete-modal').style.display='flex'">Delete Server</button>
            </div>

        </div>

        <!-- Right Column -->
        <div>
            <!-- Resource Management -->
            <div class="section-card"
                style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                <h3 style="margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">
                    Resource Management</h3>

                <div class="form-group">
                    <label for="cpu_limit">CPU Limit (%)</label>
                    <input type="number" id="cpu_limit" name="cpu_limit" value="{{ server.cpu_limit }}" min="0">
                </div>

                <div class="form-group">
                    <label for="ram_limit">RAM Limit (MB)</label>
                    <input type="number" id="ram_limit" name="ram_limit" value="{{ server.ram_limit }}" min="0">
                </div>

                <div class="form-group">
                    <label for="swap_limit">Swap Limit (MB)</label>
                    <input type="number" id="swap_limit" name="swap_limit" value="{{ server.swap_limit }}" min="-1">
                </div>

                <div class="form-group">
                    <label for="disk_limit">Disk Limit (MB)</label>
                    <input type="number" id="disk_limit" name="disk_limit" value="{{ server.disk_limit }}" min="0">
                </div>

                <div class="form-group">
                    <label for="io_weight">Block IO Weight</label>
                    <input type="number" id="io_weight" name="io_weight" value="{{ server.io_weight }}" min="10" max="1000">
                </div>

                <div class="form-group" style="display: flex; align-items: center; gap: 10px; margin-top: 1rem;">
                    <input type="checkbox" id="oom_killer" name="oom_killer" {% if server.oom_killer %}checked{% endif %} style="width: auto;">
                    <label for="oom_killer" style="margin-bottom: 0;">Enable OOM Killer</label>
                </div>
            </div>

            <!-- Image Configuration -->
             <div class="section-card"
             style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem;">
             <h3 style="margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">
                 Image Configuration</h3>

             <!-- TODO: Allow changing Nest/Egg? Complex due to variables. For now allow Docker Image & Startup -->
             
             <div class="form-group">
                 <label for="docker_image">Docker Image</label>
                 <input type="text" id="docker_image" name="docker_image" value="{{ server.docker_image }}" required>
             </div>

             <div class="form-group">
                 <label for="startup_command">Startup Command</label>
                 <input type="text" id="startup_command" name="startup_command" value="{{ server.startup_command }}">
             </div>
         </div>
        </div>
    </div>

    <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 2rem; display: flex; justify-content: flex-end;">
        <button type="submit" class="btn btn-primary">Update Server</button>
    </div>
</form>

<!-- Delete Modal -->
<div id="delete-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000;">
    <div style="background: white; padding: 2rem; border-radius: 8px; max-width: 500px; width: 100%;">
        <h3 style="margin-top: 0; color: #c53030;">Delete Server</h3>
        <p>Are you sure you want to delete this server? All data will be permanently lost.</p>
        
        <form action="/servers/{{ server.id }}/delete" method="POST">
            <div class="form-group" style="margin-bottom: 1.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; color: #c53030; font-weight: bold;">
                    <input type="checkbox" name="force" style="width: auto;">
                    Force Delete (Ignore Errors)
                </label>
                <small style="display: block; margin-top: 0.5rem; color: #666;">
                    Enable this if the server cannot be deleted normally (e.g. node offline).
                </small>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 1rem;">
                <button type="button" class="btn" style="background: #e2e8f0; color: #4a5568;" onclick="document.getElementById('delete-modal').style.display='none'">Cancel</button>
                <button type="submit" class="btn btn-danger">Yes, Delete Server</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}
